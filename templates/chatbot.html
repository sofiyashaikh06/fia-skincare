{% extends "base.html" %}
{% block content %}

<div class="chat-wrapper">

    <div class="chat-card">
        <h2 class="chat-title">ðŸŒ™ FIA AI Skin Assistant</h2>
        <p class="chat-subtitle">ðŸ§  Our AI analyzes your skin profile to create a smart routine tailored just for you.
        </p>

        <div class="form-group">
            <label>ðŸ’§ Skin Type</label>
            <select id="skinType">
                <option value="">Select</option>
                <option value="Dry">Dry</option>
                <option value="Oily">Oily</option>
                <option value="Combination">Combination</option>
                <option value="Sensitive">Sensitive</option>
            </select>
        </div>

        <div class="form-group">
            <label>ðŸŽ¯ Skin Concern</label> 
            <select id="concern">
                <option value="">Select</option>
                <option value="Acne">Acne</option>
<option value="Pigmentation">Pigmentation</option>
<option value="Dullness">Dullness</option>
                <option value="Dark Spots">Dark Spots</option>
            </select>
        </div>

        <button class="premium-btn" onclick="generateRoutine()">
            âœ¨ Generate My AI Routine
        </button>

        <div class="chat-result" id="resultBox">
            <p>Your personalized skincare routine will appear here...</p>
        </div>

    </div>

</div>

<!-- JavaScript -->
<script>
function generateRoutine() {
    const skinType = document.getElementById("skinType").value;
    const concern = document.getElementById("concern").value;
    const resultBox = document.getElementById("resultBox");

    if (!skinType || !concern) {
        resultBox.innerHTML = "<p style='color:#ff4f81;'>Please select both options ðŸ’–</p>";
        return;
    }

    // ðŸ§  Typing Animation Start
    resultBox.innerHTML = `
        <div class="ai-typing">
            <span>Analyzing your skin profile</span>
            <div class="dots">
                <span></span><span></span><span></span>
            </div>
        </div>
    `;

    setTimeout(() => {

        fetch("/recommend", {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: `skin_type=${skinType}&concern=${concern}`
        })
        .then(response => response.json())
        .then(data => {

            if (data.length === 0) {
                resultBox.innerHTML = "<p>No products found ðŸ˜¢</p>";
                return;
            }

            let html = `
                <p class="ai-complete">ðŸ§  AI Analysis Complete!</p>
                <p class="ai-summary">
                    Based on your <b>${skinType}</b> skin and 
                    <b>${concern}</b> concern, here is your optimized routine:
                </p>
                <ul class="ai-product-list">
            `;

            data.forEach(product => {
                html += `
                    <li>
                        <a href="${product.url}">
                            âœ¨ ${product.name}
                        </a>
                    </li>
                `;
            });

            html += "</ul>";

            resultBox.innerHTML = html;

        })
        .catch(error => {
            resultBox.innerHTML = "<p style='color:red;'>Something went wrong ðŸ˜¢</p>";
        });

    }, 1800); // delay for realistic AI effect
}
</script>

{% endblock %}