{% extends "base.html" %}
{% block content %}

<div class="chat-wrapper">

    <div class="chat-card">
        <h2 class="chat-title">ðŸŒ™ FIA AI Skin Assistant</h2>
        <p class="chat-subtitle">Tell us your skin type & concern for a personalized routine</p>

        <div class="form-group">
            <label>ðŸ’§ Skin Type</label>
            <select id="skinType">
                <option value="">Select</option>
                <option value="Dry">Dry</option>
                <option value="Oily">Oily</option>
                <option value="Combination">Combination</option>
                <option value="Sensitive">Sensitive</option>
            </select>
        </div>

        <div class="form-group">
            <label>ðŸŽ¯ Skin Concern</label> 
            <select id="concern">
                <option value="">Select</option>
                <option value="Acne">Acne</option>
<option value="Pigmentation">Pigmentation</option>
<option value="Dullness">Dullness</option>
                <option value="Dark Spots">Dark Spots</option>
            </select>
        </div>

        <button class="premium-btn" onclick="generateRoutine()">
            âœ¨ Get My Routine
        </button>

        <div class="chat-result" id="resultBox">
            <p>Your personalized skincare routine will appear here...</p>
        </div>

    </div>

</div>

<!-- JavaScript -->
<script>
function generateRoutine() {
    const skinType = document.getElementById("skinType").value;
    const concern = document.getElementById("concern").value;
    const resultBox = document.getElementById("resultBox");

    if (!skinType || !concern) {
        resultBox.innerHTML = "<p style='color:#ff4f81;'>Please select both options ðŸ’–</p>";
        return;
    }

    fetch("/recommend", {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded"
        },
        body: `skin_type=${skinType}&concern=${concern}`
    })
    .then(response => response.json())   // âœ… CHANGE HERE
    .then(data => {

        if (data.length === 0) {
            resultBox.innerHTML = "<p>No products found ðŸ˜¢</p>";
            return;
        }

        let html = "<h3>âœ¨ Recommended Products:</h3><ul>";

        data.forEach(product => {
            html += `
                <li style="margin:10px 0;">
                    <a href="${product.url}" 
                       style="color:#ff4f81; font-weight:600; text-decoration:none;">
                       ${product.name}
                    </a>
                </li>
            `;
        });

        html += "</ul>";

        resultBox.innerHTML = html;
    })
    .catch(error => {
        resultBox.innerHTML = "<p style='color:red;'>Something went wrong ðŸ˜¢</p>";
    });
}
</script>

{% endblock %}